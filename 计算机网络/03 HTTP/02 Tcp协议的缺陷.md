### Tcp协议的缺陷
1. 传输效率较低：TCP协议为了保证数据的可靠性，采用了复杂的确认机制和重传机制，这些机制会增加数据在网络中的传输次数，从而导致传输效率较低，特别是在高延迟、高丢包率的网络环境下，传输效率更加低下。
2. 拥塞控制不够灵活：TCP协议的拥塞控制机制是基于全局的网络拥塞情况进行调整的，不能针对单个连接进行优化。这种机制会导致某个连接因为网络拥塞而被限制带宽，从而影响其传输速度，而其他连接则不受影响。
3. 容易受到攻击：TCP协议的传输过程中，数据包的来源和目的地都可以伪造，这给中间人攻击、IP欺骗等攻击方式提供了可能。同时，由于TCP协议没有加密的机制，所以数据包内容也容易被窃听和篡改。
4. 不适合实时应用：由于TCP协议需要多次确认和重传数据，因此对于实时性要求较高的应用，如实时视频、游戏等，TCP协议的延迟和不确定性可能导致不良的用户体验。
5. 总之，TCP协议虽然是一种可靠的传输协议，但是它的传输效率较低、拥塞控制不够灵活、容易受到攻击、不适合实时应用等缺陷，限制了其在某些场景下的应用。为了解决这些问题，人们正在研究和开发一些新的传输协议，如QUIC协议等。

### TCP
1. 面向链接，传输效率低，复杂的确认机制和重传机制，这些机制会增加数据在网络中传输的次数
2. 阻塞控制，降低速率，减轻网络负载和拥塞速度
3. 流量控制，通过滑动窗口来实现，动态的控制发送的效率。
4. 全双工通信：TCP 连接是全双工的，即客户端和服务器可以同时进行数据的发送和接收。在关闭连接之前，双方需要确保彼此的数据都已经发送完毕，以免造成数据丢失或不完整。

数据传输确认：通过四次挥手过程，双方可以相互确认对方已经接收到所有数据。在关闭连接之前，双方会交换确认报文段，以确保所有数据都已经被正确传输。

确定关闭顺序：四次挥手过程中，先发起关闭连接的一方会等待对方的确认报文段，以确保双方按照正确的顺序进行连接关闭。这样可以避免数据的混乱和错误的连接状态。

处理延迟数据：在关闭连接后，仍然可能有一些延迟的数据在网络中传输，这些数据可能是之前发送的但未及时到达的。通过四次挥手过程中的 TIME_WAIT 状态，可以确保双方在关闭连接后的一段时间内能够处理到达的延迟数据，避免数据混乱。

资源释放：四次挥手的最后一步是双方都确认关闭连接，并释放相关的资源。这样可以有效地回收和释放网络连接所占用的资源，避免资源泄露和浪费。


### Tcp连接原理
1. TCP（传输控制协议）是一种面向连接的、可靠的传输协议，它在网络层（第三层）和应用层（第四层）之间提供了可靠的数据传输服务。下面是 TCP 数据传输的原理解释：
2. 连接建立：在进行数据传输之前，发送方（客户端）和接收方（服务器）需要先建立一个 TCP 连接。连接建立过程中，双方交换一系列的控制报文段（SYN 和 ACK），确立连接并进行参数协商。
3. 数据分割：发送方将要传输的数据分割成合适的大小（根据 MSS 最大报文段长度）的数据块，每个数据块称为一个 TCP 报文段。这样可以适应不同网络环境的传输需求。
4. 可靠传输：发送方将每个 TCP 报文段添加一个序列号（Sequence Number）后发送给接收方。接收方收到报文段后，会发送确认报文段（ACK）给发送方，表示已经正确接收到报文段。如果发送方没有收到确认报文段，会进行超时重传，确保数据的可靠传输。
5. 流量控制：TCP 通过使用滑动窗口（Sliding Window）来进行流量控制，确保发送方和接收方之间的数据传输速率匹配。接收方通过确认报文段中的窗口大小告诉发送方自己的接收能力，发送方根据窗口大小来控制发送数据的速度。
6. 拥塞控制：TCP 通过拥塞窗口（Congestion Window）来进行拥塞控制，避免网络拥塞和传输过程中的数据丢失。发送方根据网络的拥塞状况和接收方的反馈调整拥塞窗口大小，以控制发送的数据量。
7. 接收方缓存：接收方使用接收缓存来暂存接收到的数据，确保数据的顺序性和完整性。接收方会根据序列号将接收到的数据按正确的顺序进行组装。
8. 连接关闭：数据传输完成后，发送方和接收方需要进行连接的关闭。通过四次挥手的过程，双方交换确认报文段，最终关闭连接并释放相关资源。

### Tcp连接的必要性
1. 确保数据传输完整：在连接关闭之前，双方需要确认彼此的数据都已经传输完毕。四次挥手过程中，双方会交换确认报文段，以确保所有数据都已经被正确传输。这样可以避免数据的丢失或不完整。
2. 处理延迟数据：在关闭连接后，仍然可能有一些延迟的数据在网络中传输，这些数据可能是之前发送的但未及时到达的。通过四次挥手过程中的TIME_WAIT状态，可以确保双方在关闭连接后的一段时间内能够处理到达的延迟数据，避免数据混乱。
3. 确定关闭顺序：四次挥手过程中，先发起关闭连接的一方会等待对方的确认报文段，以确保双方按照正确的顺序进行连接关闭。这样可以避免连接状态的错误和数据的混乱。
4. 释放资源：四次挥手的最后一步是双方都确认关闭连接，并释放相关的资源。这样可以有效地回收和释放网络连接所占用的资源，避免资源泄露和浪费。

### 滑动窗口传输数据
1. 流量控制：发送方根据接收方的窗口大小来限制发送数据的速率，以避免接收方无法及时处理或数据丢失。
2. 有序传输：接收方根据滑动窗口的滑动来指示希望接收的下一个数据的序号，确保接收到的数据按正确的顺序组装。
3. 可靠传输：发送方维护一个已发送未确认的窗口，只有在收到接收方的确认后，才会将新的数据添加到发送窗口中并发送出去。如果发送方没有收到确认，会进行超时重传，以确保数据的可靠传输。
4. 拥塞控制：通过拥塞窗口的调整，TCP可以根据网络状况和接收方的反馈来避免网络拥塞和传输过程中的数据丢失。
5. 滑动窗口机制还可以应用于其他协议和通信方式中，例如滑动窗口ARQ（自动重传请求）协议用于数据链路层的可靠传输，滑动窗口协议也可以用于实现可靠的串行通信。

### TCP的性能
1. TCP 是一种可靠的传输协议，它提供了许多保证数据传输可靠性和完整性的机制。但是这些机制在某些情况下可能会带来性能开销。以下是一些可能影响 TCP 性能的因素
2. 拥塞控制：TCP 通过拥塞控制算法来避免网络拥塞，以确保数据正确传输。但是，这个算法可能会导致 TCP 在网络拥塞时表现不佳，因为它会减慢数据传输速度。
3. 延迟确认：TCP 使用延迟确认机制来优化网络吞吐量，但是这个机制可能会导致一定的延迟，从而降低传输性能。
4. 拥塞窗口大小：拥塞窗口大小指定了 TCP 可以发送的数据量。如果窗口大小过小，它可能会限制传输速度；如果窗口大小过大，它可能会导致网络拥塞。
5. Nagle 算法：Nagle 算法可以减少网络中的小数据包数量，从而提高网络吞吐量。但是，这个算法也可能会导致一定的延迟，因为它会等待缓冲区中的数据达到一定数量才发送数据包。

### Http2新特性
1. 多路复用（Multiplexing）：HTTP/2可以在同一个TCP连接上同时进行多个请求和响应，而不需要按照顺序进行。这消除了HTTP/1.x中的队头阻塞问题，提高了页面加载速度和性能。
2. 二进制分帧（Binary Framing）：HTTP/2将HTTP消息拆分为更小的二进制帧并进行传输。这种方式有助于减少网络延迟并提高带宽利用率，同时允许服务器和客户端交错处理多个请求和响应。
3. 首部压缩（Header Compression）：HTTP/2使用HPACK算法对HTTP首部进行压缩，减少了首部字段的大小。这减少了网络传输中的数据量，降低了延迟和带宽消耗。
4. 服务器推送（Server Push）：HTTP/2允许服务器在客户端请求之前主动推送相关资源。这样可以减少客户端发起的额外请求，加快页面加载速度。
5. 优先级（Priority）：HTTP/2引入了流优先级概念，允许客户端指定请求的优先级。这使得服务器可以优先处理重要资源，提高用户体验。
6. 流量控制（Flow Control）：HTTP/2引入了一种流控制机制，用于避免发送方过载接收方。它确保了性能平衡，防止网络拥塞。
7. 安全性增强（Enhanced Security）：HTTP/2要求使用加密的传输层（TLS）来保护数据的安全性。这提高了通信的安全性，防止中间人攻击和窃听。
8. HTTP/2的新特性旨在提高网站的加载速度、性能和安全性。它通过多路复用、二进制分帧、首部压缩等技术手段，使得网络通信更高效，并提供更好的用户体验。
