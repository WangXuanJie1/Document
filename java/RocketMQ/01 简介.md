# RocketMQ简介
1. RocketMQ是提供消息队列的中间价
2. 常见的消息协议，JMO，

## RocketMQ组成部分
1. message消息，消息就是数据
2. 主体Topic，表示一类消息的集合，每条消息只属于一个集合，消息订阅的基本单位。
3. 标签tag：用于同一主题下面的不同类型的数据
4. 队列queue：存储消息物理实体，一个topic中有多个queue，每个queue就是存放topic的消息，kafka中就是分区。一个消费者只能消费一个topic中的一个queue
5. 分片：分片不同于分区，在rocket中分片是topic中broker的数量就是queue，每个queue的大小都是一样的
6. 消息标识messageId：生产者生成+produceip+进程pid+hashcode+当前时间+自增计数器
7. offsetMsgId：由broker生成，brokerIP+物理分区的offset
8. key：相关业务的唯一标识

## 系统架构
1. producer消费者，消费者都是以生产者组的形式出现的，生产者组是同一类生产者的集合，这类Producer发送相同的topic消息
2. consumer：消费者从broker（交换机）获取消息。
3. nameserver: 是一个Broker和Topic的路由注册中心，支持Broker的动态注册和发现  
   1.broker管理：接受Broker集群的注册并且保存下来作为路由信息的基本数据，提供心跳检测机制，检查broker是否存活  
   2.路由信息管理：每个NameServer都有Broker路由信息和客户端查询队列信息，Produce和Conumer通过Nameserver可以获取Broker路由信息，从而进行消息的投递和消费  
   3.路由注册：NameServer集群方式启动，Broker轮询NameServer列表，与每个NameServer节点建立长连接，发起注册请求。broker每30s发送心跳包到broker，BrokerIp，Broker地址，Broker名称。收到之后会更新时间戳更新存活时间  
   4.路由剔除：由于broker关机的原因，没有收到心跳就会剔除， NameServer有定时任务，每隔10s进行扫描，心跳时间超过1210s就会剔除  
   5.路由发现路由采用pull模型，。tioic信息发送变化的时候，客户端实在主动拉取信息的，30s  
   6.NameServer选择策略：客户端生成随机数进行节点数取模，就是节点的索引，如果连接失败采用round-robin策略，逐个尝试去来连接其他节点  

