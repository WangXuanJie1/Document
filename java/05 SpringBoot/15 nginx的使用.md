### 正向代理和反向代理
正向代理（Forward Proxy）和反向代理（Reverse Proxy）是网络中常用的两种代理服务方式。
1. 正向代理是指代理服务器位于客户端和目标服务器之间，客户端通过正向代理服务器向目标服务器发送请求，代理服务器将请求转发给目标服务器，并将响应返回给客户端。在这种情况下，目标服务器并不知道实际发起请求的客户端身份，只知道请求来自于代理服务器。正向代理服务器可以用于访问受限制的资源、提供匿名性、缓存等功能。
2. 反向代理是指代理服务器位于目标服务器和客户端之间，客户端发送请求到反向代理服务器，反向代理服务器根据一定的规则将请求转发给后端的目标服务器处理，并将响应返回给客户端。在这种情况下，客户端并不知道实际提供响应的目标服务器身份，只知道响应来自于反向代理服务器。反向代理服务器可以用于负载均衡、安全防护、缓存等功能。
3. 总结起来，正向代理是代理服务器代表客户端向目标服务器发送请求（并不知道客户端是谁），而反向代理是代理服务器代表目标服务器处理客户端的请求。它们在网络通信中扮演着不同的角色，用于实现不同的功能和需求。（中间相应的）

### nginx是什么 
1. Nginx（发音为"engine-x"）是一个开源的高性能的 HTTP 和反向代理服务器，也可以用作邮件代理服务器。它最初由伊戈尔·赫勒维奇于2004年创建，并在2004年公开发布。Nginx 专为性能优化而开发，具有低内存消耗和高并发处理能力，因此在 Web 服务器领域广受欢迎。
2. Nginx 被设计用于解决 C10K 问题（即同时连接数超过 10000 的问题），其事件驱动、异步非阻塞的架构使其能够高效地处理大量并发连接。除了作为 HTTP 服务器和反向代理服务器外，Nginx 还可以用于负载均衡、静态资源服务、缓存加速等场景。
3. 总之，Nginx 是一个功能强大且性能优越的 Web 服务器和反向代理服务器，被广泛用于构建高性能的网站和应用程序服务。

### nginx的作用
1. 反向代理服务器： 用户只知道代理服务器的地址，目标服务器处理最终的请求。客户端不知道最终相应的服务端是谁
2. 动静分离： 提高网站性能，静态资源直接返回不经过后端，减轻后端压力，节省网络带宽，简化缓存策略，还可以添加CDN提高效率。缓存是通过
3. 负载均衡：轮询，加权，ipHASH，最少连接，随机，URLHASH，响应时间

### nginx静态资源添加缓存，使用http响应头实现
Cache-Control: 用于定义缓存行为和缓存的有效期。常见的指令有：
public：表示响应可以被所有用户（包括代理服务器）缓存。
private：表示响应只能被单个用户缓存，不能由共享缓存（如代理服务器）缓存。
no-cache：表示请求时必须发送到服务器进行验证，不能直接使用缓存的响应。
max-age=<seconds>：表示资源的最大缓存时间，以秒为单位。
s-maxage=<seconds>：类似于 max-age，但仅适用于共享缓存（如代理服务器）。
Expires: 用于指定资源的过期时间，是一个绝对时间。例如：Expires: Thu, 31 Dec 2023 23:59:59 GMT。这个值会告诉浏览器，在过期时间之前，可以直接从缓存中获取资源。
ETag：用于标识资源的实体标签，可以避免由于修改时间不同而导致缓存失效的问题。浏览器在发送请求时会带上 If-None-Match 头，将上次获取的 ETag 值发送给服务器，服务器通过比较当前资源的 ETag 和请求中的 If-None-Match 值来判断资源是否有更新。
Last-Modified：用于指示资源最后一次修改的时间。浏览器在发送请求时会带上 If-Modified-Since 头，将上次获取的 Last-Modified 值发送给服务器，服务器通过比较当前资源的修改时间和请求中的 If-Modified-Since 值来判断资源是否有更新。
通过设置这些响应头信息，可以控制缓存的行为和有效期，从而提高网站性能和用户体验。

### nginx热加载机制
Nginx的热加载机制是通过Master-Worker架构和信号处理来实现的。下面是具体的实现方式：
1. Master-Worker架构：Nginx采用Master-Worker架构，主进程负责管理工作进程。在启动Nginx时，主进程会读取配置文件，并创建多个工作进程来处理请求。每个工作进程都是相互独立的，可以处理客户端的请求。
2. 配置文件解析与存储：当Nginx启动时，主进程会读取配置文件，并将配置信息存储在内存中。这些配置信息包括监听的端口、代理规则、负载均衡策略等。
3. 信号处理：Nginx使用信号来与主进程进行通信。主要使用的信号有SIGHUP（重新加载配置）和SIGUSR1（平滑重载）。
4. 重新加载配置（SIGHUP）：当接收到SIGHUP信号时，主进程会触发重新加载配置的操作。它会首先检查新的配置文件语法是否正确，如果正确，主进程会创建一个新的工作进程，并将新的配置信息发送给新的工作进程。然后，主进程会向旧的工作进程发送信号，通知它们停止接收新的连接，并逐步处理完当前的连接。当旧的工作进程处理完所有连接后，它们会被关闭，并由新的工作进程接管所有请求。
5. 平滑重载（SIGUSR1）：Nginx还支持平滑重载，通过SIGUSR1信号实现。在平滑重载过程中，主进程会创建一个新的工作进程，但不会关闭旧的工作进程，而是将新的连接交给新旧两个工作进程同时处理。新的工作进程会使用新的配置信息来处理请求，而旧的工作进程则继续处理原来的连接。当旧的工作进程处理完当前的连接后，它们会被关闭，只有新的工作进程会继续处理请求
6. 通过Master-Worker架构和信号处理，Nginx能够在不停止服务的情况下重新加载配置文件。这样就实现了热加载的效果，使得系统能够动态地更新配置，而无需中断正在处理的连接。这对于高负载的生产环境非常有用，可以实现零停机更新和配置

### nginx 的worker工作机制
Nginx的工作请求机制是基于事件驱动的异步非阻塞模型，它的核心是一个主进程和多个工作进程（worker process）。
主进程启动：当Nginx启动时，主进程会先读取配置文件，并进行一些初始化操作。主进程负责管理工作进程的生命周期，接收信号（如重启、停止等），以及处理共享内存区域的操作。
工作进程创建：主进程在启动时会根据配置文件中的worker_processes指令创建多个工作进程。每个工作进程独立运行，负责处理客户端请求。
事件驱动的处理：工作进程使用事件驱动的方式监听并处理来自客户端的请求。当有新连接进入或有数据可读写时，工作进程会触发相应的事件，并执行对应的处理函数。
非阻塞I/O操作：Nginx通过使用非阻塞I/O操作来实现高并发和高性能。工作进程在处理请求时，不会阻塞等待I/O操作完成，而是将其交给操作系统处理，并继续处理其他请求。这样可以有效地利用系统资源，提高并发处理能力。
请求处理流程：当有新的客户端请求到达时，工作进程会按照配置文件中的server块和location块进行请求匹配。根据匹配结果，工作进程会执行相应的处理逻辑，如返回静态文件、代理转发、负载均衡等。
响应返回：当工作进程完成请求处理后，会将响应数据返回给客户端。如果响应较大，Nginx也支持分块传输，可以提高响应速度并减少内存消耗。
通过以上的工作请求机制，Nginx能够高效地处理大量并发请求，同时保持低资源占用和快速响应的特性。这使得Nginx成为一个流行的Web服务器和反向代理服务器。

### 多进程模型
1. 主进程（master process）：当Nginx启动时，会创建一个主进程，负责管理其他工作进程的生命周期以及处理信号。主进程会读取配置文件，初始化服务器，然后创建多个工作进程来处理实际的请求。
工作进程（worker process）：主进程会创建多个工作进程，每个工作进程都是一个独立的进程，负责接收客户端的请求、处理请求并发送响应。这些工作进程是相互独立的，彼此之间不共享内存，从而避免了多进程并发访问同一份数据的竞争和同步问题。
事件驱动模型：Nginx使用事件驱动模型来实现高效的I/O多路复用，即每个工作进程会在一个事件循环中等待事件的发生，例如新的连接到达、数据可读或可写等。这种模型能够有效地处理大量的并发连接，而不会因为阻塞等待而浪费系统资源。
进程间通信：Nginx通过进程间通信（IPC）机制来实现主进程与工作进程之间的协调和通信，例如在配置重载、平滑升级等操作时，主进程会向工作进程发送信号来指示它们进行相应的操作。
总的来说，Nginx的多进程模型利用主进程和多个独立的工作进程配合协作，可以实现高并发、高性能的请求处理能力，并且具有良好的扩展性和稳定性。这种模型能够充分利用多核CPU的优势，提供可靠的服务质量，是Nginx成为高性能Web服务器和反向代理服务器的重要原因之一。
